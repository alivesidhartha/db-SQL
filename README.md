# Домашнее задание к занятию «SQL. Часть 2» - Макану Александр


### Задание 1

1.1. Для восстановления данных за предыдущий день подходит полное резервное копирование (Full Backup). В этом случае создаётся полная копия базы данных, либо копируются все файлы, в которых она хранится. Полный бэкап выполняется ежедневно и позволяет восстановить данные в случае сбоя. Основное требование — достаточный объём хранилища для хранения нескольких копий.

1.2. Чтобы восстановить данные за час до поломки, лучше всего использовать инкрементное или дифференциальное копирование, дополненное сохранением журналов транзакций (WAL для PostgreSQL, Binary Log для MySQL).

Раз в сутки создаётся полный бэкап.
Через регулярные интервалы (например, каждый час) выполняется дифференциальное или инкрементное копирование, фиксирующее изменения.
Каждые несколько минут сохраняются журналы транзакций, которые позволяют восстановить базу на конкретный момент времени.
В случае сбоя сначала восстанавливается полный бэкап, затем последняя дифференциальная или инкрементная копия, а потом применяются журналы транзакций.

### Задание 2

Для резервного копирования базы данных PostgreSQL можно использовать утилиту pg_dump. Она позволяет выгрузить данные в различных форматах. Например, для создания резервной копии базы данных sakila:
```
pg_dump -Fc sakila > sakila_backup.dump
```

Чтобы восстановить данные в новую базу, можно выполнить следующую команду:
```
pg_restore -d sakila sakila_backup.dump
```

Если требуется удалить текущую базу перед восстановлением и создать её заново, используется флаг -C:
```
pg_restore -C -d postgres sakila_backup.dump
```

Также можно выгружать базу данных в SQL-скрипт:
```
pg_dump sakila > sakila_backup.sql
```

А затем восстановить её с помощью psql:
```
psql -X -d sakila -f sakila_backup.sql
```

### Задание 3

Для инкрементного резервного копирования в MySQL используются бинарные логи. Сначала нужно включить их в my.cnf (log-bin=mysql-bin) и перезапустить MySQL.

Полное резервное копирование выполняется командой:

```
mysqldump --flush-logs --delete-master-logs --single-transaction --all-databases > full_backup.sql
```

Затем для инкрементного бэкапа создаётся новый бинарный лог:

```
FLUSH BINARY LOGS;
```
После этого копируются все бинарные логи, кроме последнего.

Для восстановления сначала загружается полный бэкап, а затем бинарные логи применяются через mysqlbinlog.